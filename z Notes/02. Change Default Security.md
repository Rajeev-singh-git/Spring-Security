# 2. Changing Default Security Configuration

---

## Table of Contents

1. [Creating Backend REST APIs](#21-creating-backend-rest-apis-for-easybank)
2. [Understanding Default Security Configuration](#22-understanding-Default-Security-Configuration)
3. [Customizing Spring Security Rules](#23-Customizing-Spring-Security-Rules)
4. [Disabling formLogin() and httpBasic()](2.4-Disabling-formLogin()-and-httpBasic()

---

### 2.1 Creating Backend REST APIs for EasyBank

- Created six REST controllers for EasyBank backend:
  - `/contact`, `/notices`, `/myAccount`, `/myBalance`, `/myLoans`, `/myCards`
- Spring Security by default secures all endpoints.
- **API path names are case-sensitive** ‚Äî must exactly match in security configurations.
- Verified login session persistence using `JSESSIONID`.

##### Practice Code

```java
@RestController
public class AccountController {
    @GetMapping("/myAccount")
    public String getAccountDetails() {
        return "Here are the account details from the DB";
    }
}
```

üí° **Insight:**  
Spring Security enforces authentication on all endpoints by default, requiring explicit customization for public access.

‚ö†Ô∏è **Gotcha:**  
A single mismatch in API path case or spelling between controller and security configuration causes access or 404 errors.

---

### 2.2 Understanding Default Security Configuration

- Explored default setup in `SpringBootWebSecurityConfiguration`.
- Default `SecurityFilterChain` bean defines:
  - `authorizeHttpRequests().anyRequest().authenticated()` ‚Üí secures all endpoints.
  - `formLogin(withDefaults())` ‚Üí enables default login page.
  - `httpBasic(withDefaults())` ‚Üí enables basic auth for API clients.
- Copied same logic into custom class `ProjectSecurityConfig` under `com.eazybytes.config`.
- Custom bean overrides framework‚Äôs default once defined.
  - Because Spring Boot auto-configurations back off when a user-defined `SecurityFilterChain` is present.

##### Code

```java
@Configuration
public class ProjectSecurityConfig {
    @Bean
    SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
        http.authorizeHttpRequests(auth -> auth.anyRequest().authenticated())
            .formLogin(Customizer.withDefaults())
            .httpBasic(Customizer.withDefaults());
        return http.build();
    }
}
```

üí° **Insight:**  
Defining a custom `SecurityFilterChain` bean gives complete control over API access rules and replaces Spring‚Äôs built-in defaults.

‚ö†Ô∏è **Gotcha:**  
If you replicate the framework‚Äôs defaults exactly, behavior remains unchanged ‚Äî customization takes effect only after modifying the authorization chain.

---

### 2.3 Customizing Spring Security Rules

- `anyRequest()` + `permitAll()` or `denyAll()` overrides all rules ‚Üí makes app fully public or blocked.
- `requestMatchers()` enables selective security control per endpoint:
  - `/myAccount`, `/myBalance`, `/myLoans`, `/myCards` ‚Üí `authenticated()`
  - `/contact`, `/notices`, `/error` ‚Üí `permitAll()`
- `permitAll()` allows unauthenticated access; `denyAll()` forbids all (rare use).
- `/error` must be public; else Spring Security hides runtime exceptions behind 403 errors.

##### Code

```java
http.authorizeHttpRequests(req -> 
    req.requestMatchers("/myAccount", "/myBalance", "/myLoans", "/myCards").authenticated()
       .requestMatchers("/contact", "/notices", "/error").permitAll()
).formLogin(Customizer.withDefaults())
 .httpBasic(Customizer.withDefaults());
```

üí° **Insight:**  
`requestMatchers()` enables fine-grained control over API access‚Äîbalancing public and secured routes based on business needs.

‚ö†Ô∏è **Gotcha:**  
If you use `permitAll()` or `denyAll()` with `anyRequest()`, you override all security, defeating the purpose of Spring Security.

---

### 2.4 Disabling formLogin() and httpBasic()

- **formLogin()** ‚Üí standard browser-based authentication.  
  Redirects to a login page where user submits credentials via an HTML form.  
  Handled by `UsernamePasswordAuthenticationFilter`.
- **httpBasic()** ‚Üí stateless, API-oriented authentication.  
  Browser displays a login popup; credentials sent in header as  
  `Authorization: Basic <Base64(username:password)>`.  
  Handled by `BasicAuthenticationFilter`.
- Both are enabled by default in Spring Security.
- Disable login types using lambdas:
  
  ```java
  .formLogin(flc -> flc.disable())
  .httpBasic(hbc -> hbc.disable())
  ```

- Disabling **formLogin()** ‚Üí removes Spring‚Äôs default login page.

- Disabling **httpBasic()** ‚Üí disables the browser popup / header-based authentication.

- Disabling both ‚Üí no authentication entry point; all secured endpoints return **403 Forbidden**.

- Avoid deprecated syntax like `.formLogin().disable()` (removed in Spring Security 7).

```java
 @Bean
 SecurityFilterChain defaultSecurityFilterChain(HttpSecurity http) throws Exception {
   http.authorizeHttpRequests((requests) -> requests
                .requestMatchers("/myAccount","/myBalance","/myLoans","/myCards").authenticated()
                .requestMatchers("/notice","/contact","/error").permitAll());
   http.formLogin(flc -> flc.disable());
   http.httpBasic(hbc -> hbc.disable());
   return http.build();
 }
```

üí° **Insight:**  
`formLogin()` suits web UIs; `httpBasic()` suits REST APIs.  
Each works through its own authentication filter ‚Äî disabling one removes that login route.

‚ö†Ô∏è **Gotcha:**  
If both are disabled, Spring Security has no authentication path ‚Äî all protected requests fail with 403.


