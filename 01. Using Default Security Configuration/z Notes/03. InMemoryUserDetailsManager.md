# 3. In Memory User Details Manager

This repository contains my notes and code while learning **Spring Security**.  
Each section corresponds to one course module, with commits documenting concept-level progress.

---

## Table of Content

1. [Creating Multiple In-Memory Users](1-Creating-Multiple-In-Memory-Users-using-InMemoryUserDetailsManager)
2. [Configuring PasswordEncoder Using PasswordEncoderFactories]()

---

## 1. Creating Multiple In-Memory Users using InMemoryUserDetailsManager

- Replaced single static credentials from `application.properties` with multiple users created in memory.

- `UserDetailsService` ‚Üí interface used by `DaoAuthenticationProvider` to fetch user credentials and authorities from a data source (in-memory, DB, etc.) during authentication.  
  Extended by `UserDetailsManager`, which also supports user creation, updates, and deletions.

- `InMemoryUserDetailsManager` ‚Üí implementation that stores user accounts in app memory (internally backed by a HashMap).

- `{noop}` prefix disables password encoding (treats passwords as plain text) ‚Äî **only for demos**, not production.

- Example admin user:
  
  ```java
  UserDetails admin = User.withUsername("admin")
                          .password("{noop}54321")
                          .authorities("admin").build();
  
  
  ```

- `InMemoryUserDetailsManager` constructor accepts varargs of users:

```java
return new InMemoryUserDetailsManager(user, admin);
```

- `DaoAuthenticationProvider` uses this service to authenticate against the stored user details.
  
  

üí° **Insight:**  
`UserDetailsService` acts as the bridge between authentication logic and user data source ‚Äî replacing or extending it changes where and how credentials are validated.

‚ö†Ô∏è **Gotcha:**  
Without `{noop}` or a configured `PasswordEncoder` bean, Spring Security rejects logins due to missing encoding information.

---

## 2. Securing Passwords with PasswordEncoder

- Hardcoding passwords in code or storing them in plain text is unsafe ‚Äî visible to anyone with code or heap dump access.
- `PasswordEncoder` ‚Üí interface used by Spring Security to hash passwords and validate them securely (one-way conversion).
- Added a PasswordEncoder bean:

```java
@Bean
  public PasswordEncoder passwordEncoder() {
      return PasswordEncoderFactories.createDelegatingPasswordEncoder();
  }
```

- `PasswordEncoderFactories.createDelegatingPasswordEncoder()`  
  ‚Üí returns a DelegatingPasswordEncoder that supports multiple encoders (bcrypt, noop, scrypt, etc.)  
  ‚Üí **default**: BCryptPasswordEncoder (recommended for production).

- Each stored password can specify its encoder using a prefix:
  
  - `{bcrypt}` ‚Üí uses BCryptPasswordEncoder (secure, one-way hashing)
  
  - `{noop}` ‚Üí uses NoOpPasswordEncoder (stores plain text, unsafe, for demo/testing only)

```java
UserDetails admin = User.withUsername("admin")
                        .password("{bcrypt}$2a$12$...")
                        .authorities("admin")
                        .build();
UserDetails user = User.withUsername("user")
                       .password("{noop}12345")
                       .authorities("read")
                       .build();
```

- **Why use factory instead of direct `new BCryptPasswordEncoder()`**:  
  Allows flexibility ‚Äî older systems using legacy encoders (e.g., MD4) can still authenticate,  
  while new users use the default `bcrypt` encoding.

##### Practice Code

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return PasswordEncoderFactories.createDelegatingPasswordEncoder();
}
```

üí° **Insight:**  
`PasswordEncoder` abstracts password hashing ‚Äî `DaoAuthenticationProvider` automatically invokes it during login to validate credentials safely.

‚ö†Ô∏è **Gotcha:**  
Without an encoder or valid prefix (like `{bcrypt}`), Spring Security throws ‚ÄúThere is no PasswordEncoder mapped for the id‚Äù errors and rejects authentication.





---

# Questions

### Why do we create a `UserDetailsService` bean when inside the method we‚Äôre just using `User` and `UserDetails`, which seem independent of it
